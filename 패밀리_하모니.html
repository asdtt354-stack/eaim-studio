<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>íŒ¨ë°€ë¦¬ í•˜ëª¨ë‹ˆ 7.0 - Deep Essay</title>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        :root {
            --primary: #6C5CE7; --secondary: #a29bfe;
            --accent: #00b894; --bg: #dfe6e9;
            --muto-skin: #ffeaa7;
        }
        body {
            font-family: 'Pretendard', sans-serif;
            background-color: var(--bg); margin: 0; padding: 20px;
            display: flex; flex-direction: column; align-items: center;
        }
        .container {
            background: white; max-width: 700px; width: 100%;
            padding: 30px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        h1 { color: var(--primary); margin: 0 0 10px 0; }
        
        .step { display: none; animation: fadeIn 0.5s; }
        .step.active { display: block; }

        /* íƒ­ ìŠ¤íƒ€ì¼ */
        .selection-area { margin-bottom: 20px; text-align: left; }
        .tab-label { font-weight: bold; color: #555; display: block; margin-bottom: 5px; font-size: 0.9rem; }
        .tab-group { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 15px; }
        .tab-btn {
            padding: 8px 12px; border: 1px solid #ccc; border-radius: 20px;
            background: white; cursor: pointer; transition: 0.2s; font-size: 0.85rem;
        }
        .tab-btn:hover { background: #eee; }
        .tab-btn.selected {
            background: var(--primary); color: white; border-color: var(--primary);
            box-shadow: 0 3px 10px rgba(108, 92, 231, 0.3); font-weight: bold;
        }

        /* ë®¤í†  ìŠ¤í…Œì´ì§€ */
        .muto-stage {
            background: #f1f2f6; border-radius: 20px; padding: 20px;
            text-align: center; margin-bottom: 20px; border: 3px solid #eee;
            position: relative; overflow: hidden; height: 180px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .muto-face {
            width: 90px; height: 90px;
            background-color: var(--muto-skin); border-radius: 50%; border: 4px solid #333;
            position: relative; display: flex; align-items: center; justify-content: center;
            font-size: 45px; transition: all 0.3s ease; z-index: 2;
        }
        .muto-ear {
            position: absolute; top: -15px; width: 25px; height: 40px;
            background-color: var(--muto-skin); border: 4px solid #333;
            border-bottom: none; border-radius: 20px 20px 0 0; z-index: 1;
        }
        .ear-left { left: 10px; transform: rotate(-10deg); }
        .ear-right { right: 10px; transform: rotate(10deg); }

        .muto-label {
            margin-top: 15px; font-weight: bold; color: #555; background: white;
            padding: 8px 15px; border-radius: 15px; border: 1px solid #ddd; font-size: 0.9rem;
            width: 90%;
        }

        /* ì…ë ¥ì°½ & ë²„íŠ¼ */
        input, textarea {
            width: 100%; padding: 12px; border: 1px solid #bdc3c7; border-radius: 8px;
            margin-bottom: 10px; font-size: 1rem; box-sizing: border-box; font-family: inherit;
        }
        button {
            background: var(--primary); color: white; border: none; padding: 12px 20px;
            border-radius: 30px; font-size: 1rem; font-weight: bold; cursor: pointer;
            transition: 0.2s; margin-top: 10px;
        }
        button:hover { transform: scale(1.05); }
        .btn-gray { background: #b2bec3; }
        .btn-green { background: var(--accent); }
        .btn-print { background: #2d3436; width: 100%; margin-top: 5px; }

        /* ë³´ê³ ì„œ ìŠ¤íƒ€ì¼ */
        .report-paper { border: 1px solid #ddd; padding: 40px; margin-top: 20px; border-radius: 5px; text-align: left; background: white; }
        .report-section { margin-bottom: 25px; border-bottom: 1px dashed #eee; padding-bottom: 20px; }
        .report-title { font-size: 1.2rem; font-weight: bold; color: var(--primary); margin-bottom: 15px; border-left: 5px solid var(--primary); padding-left: 10px; }

        /* ì§ˆë¬¸ ë°•ìŠ¤ ìŠ¤íƒ€ì¼ (Step 3) */
        .q-container {
            max-height: 400px; overflow-y: auto; padding-right: 5px; /* ìŠ¤í¬ë¡¤ë°” ê³µê°„ */
        }
        .q-card {
            background: #f8f9fa; padding: 15px; border-radius: 10px; margin-bottom: 15px; border-left: 4px solid var(--accent);
            text-align: left;
        }
        .q-text { font-weight: bold; font-size: 0.95rem; display: block; margin-bottom: 8px; color: #2d3436; }
        .q-sub { font-size: 0.8rem; color: #636e72; margin-bottom: 5px; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        @media print {
            body * { visibility: hidden; }
            #finalReport, #finalReport * { visibility: visible; }
            #finalReport { position: absolute; left: 0; top: 0; width: 100%; border: none; }
            .no-print { display: none !important; }
        }
    </style>
</head>
<body>

<div class="container">
    <header class="no-print">
        <h1>Family Harmony 7.0</h1>
        <p>Deep Essay Edition: ê¹Šì´ ìˆëŠ” ì„±ì°° ê¸€ì“°ê¸°</p>
    </header>

    <div id="step1" class="step active">
        <h2>STEP 1. ê°ˆë“± ì¡°ê° ëª¨ìœ¼ê¸° (Artscape)</h2>
        <p>ìƒí™©ì„ ì„ íƒí•˜ë©´ ì—ì„¸ì´ì˜ ì„œë¡ ì´ ì™„ì„±ë©ë‹ˆë‹¤.</p>

        <div class="selection-area">
            <span class="tab-label">1. ëˆ„ê°€? (Who)</span>
            <div class="tab-group" id="whoGroup">
                <button class="tab-btn" onclick="selectTab('who', 'ì—„ë§ˆ', this)">ğŸ‘© ì—„ë§ˆ</button>
                <button class="tab-btn" onclick="selectTab('who', 'ì•„ë¹ ', this)">ğŸ‘¨ ì•„ë¹ </button>
                <button class="tab-btn" onclick="selectTab('who', 'ë™ìƒ', this)">ğŸ‘¦ ë™ìƒ</button>
                <button class="tab-btn" onclick="selectTab('who', 'ê°€ì¡±', this)">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ ê°€ì¡±</button>
            </div>

            <span class="tab-label" style="color:#e17055;">2. ë¬´ì—‡ ë•Œë¬¸ì—? (Why)</span>
            <div class="tab-group" id="whyGroup">
                <button class="tab-btn" onclick="selectTab('why', 'ìŠ¤ë§ˆíŠ¸í°/ê²Œì„', this)">ğŸ“± ìŠ¤ë§ˆíŠ¸í°/ê²Œì„</button>
                <button class="tab-btn" onclick="selectTab('why', 'ì„±ì /ê³µë¶€', this)">ğŸ“š ì„±ì /ê³µë¶€</button>
                <button class="tab-btn" onclick="selectTab('why', 'ì²­ì†Œ/ì •ë¦¬', this)">ğŸ§¹ ì²­ì†Œ/ì •ë¦¬</button>
                <button class="tab-btn" onclick="selectTab('why', 'ë§íˆ¬/íƒœë„', this)">ğŸ’¬ ë§íˆ¬/íƒœë„</button>
                <button class="tab-btn" onclick="selectTab('why', 'ê·€ê°€ì‹œê°„/ì•½ì†', this)">â° ì‹œê°„/ì•½ì†</button>
            </div>

            <span class="tab-label" style="color:#d63031;">3. ì–´ë–¤ í–‰ë™ì„? (Action)</span>
            <div class="tab-group" id="actGroup">
                <button class="tab-btn" onclick="selectTab('act', 'í˜¼ë‚´ì…”ì„œ', this)">ğŸ˜¡ í˜¼ë‚´ì…”ì„œ</button>
                <button class="tab-btn" onclick="selectTab('act', 'ì”ì†Œë¦¬í•˜ì…”ì„œ', this)">ğŸ—£ï¸ ì”ì†Œë¦¬í•˜ì…”ì„œ</button>
                <button class="tab-btn" onclick="selectTab('act', 'ë¬´ì‹œí•˜ì…”ì„œ', this)">ğŸ”‡ ë¬´ì‹œí•˜ì…”ì„œ</button>
                <button class="tab-btn" onclick="selectTab('act', 'ë¹„êµí•˜ì…”ì„œ', this)">âš–ï¸ ë¹„êµí•˜ì…”ì„œ</button>
                <button class="tab-btn" onclick="selectTab('act', 'ë‹¤íˆ¬ì–´ì„œ', this)">âš”ï¸ ë‹¤íˆ¬ì–´ì„œ</button>
            </div>

            <span class="tab-label">4. ê·¸ë•Œ ê¸°ë¶„ì€? (Mood)</span>
            <div class="tab-group" id="moodGroup">
                <button class="tab-btn" onclick="selectTab('mood', 'í™”ë‚¨', this)">ğŸ˜¡ í™”ë‚¨</button>
                <button class="tab-btn" onclick="selectTab('mood', 'ì–µìš¸í•¨', this)">ğŸ˜¤ ì–µìš¸í•¨</button>
                <button class="tab-btn" onclick="selectTab('mood', 'ìŠ¬í””', this)">ğŸ˜¢ ìŠ¬í””</button>
                <button class="tab-btn" onclick="selectTab('mood', 'ë‹µë‹µí•¨', this)">ğŸ˜« ë‹µë‹µí•¨</button>
            </div>
        </div>

        <div class="muto-stage">
            <div class="muto-ear ear-left" id="mutoEarL"></div>
            <div class="muto-ear ear-right" id="mutoEarR"></div>
            <div class="muto-face" id="mutoFace">ğŸ˜</div>
            <div class="muto-label" id="mutoText">ì¡°ê°ì„ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”</div>
        </div>

        <hr style="border:1px dashed #ddd; margin: 20px 0;">

        <h3>ë§ˆìŒ ë²ˆì—­ê¸° (ê°€ì‚¬ ë§Œë“¤ê¸°)</h3>
        <label>âš¡ ë¾°ì¡±í•œ ë§ (Verse)</label>
        <input type="text" id="sharpInput" placeholder="ì˜ˆ: ì•„ ì™œ ìê¾¸ ì”ì†Œë¦¬ì•¼!">
        
        <label>ğŸŒˆ ë™ê·¸ë€ ë§ (Chorus)</label>
        <input type="text" id="roundInput" placeholder="ì˜ˆ: ì €ë¥¼ ë¯¿ê³  ì¡°ê¸ˆë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.">

        <button onclick="aiLyrics()">ğŸµ ê°€ì‚¬ ìƒì„±í•˜ê¸°</button>
    </div>

    <div id="step2" class="step">
        <h2>STEP 2. ê°€ì‚¬ í™•ì¸</h2>
        <div style="background:#f8f9fa; padding:10px; border-radius:10px; margin-bottom:10px; font-size:0.9rem;">
            ìƒí™©: <span id="displaySituation" style="font-weight:bold;"></span>
        </div>
        
        <label style="font-weight:bold; color:#ff7675;">[Verse]</label>
        <textarea id="verseArea" style="height:80px;"></textarea>

        <label style="font-weight:bold; color:#00b894;">[Chorus]</label>
        <textarea id="chorusArea" style="height:80px;"></textarea>
        
        <div style="display:flex; gap:10px;">
            <button class="btn-gray" onclick="goToStep(1)">ì´ì „</button>
            <button class="btn-green" onclick="goToStep(3)">ë‹¤ìŒ: ì‹¬ì¸µ ê¸€ì“°ê¸° ğŸ‘‰</button>
        </div>
    </div>

    <div id="step3" class="step">
        <h2>STEP 3. ê¹Šì´ ìˆëŠ” ì—ì„¸ì´ ì“°ê¸°</h2>
        <p>6ê°€ì§€ ì§ˆë¬¸ì— ë‹µí•˜ë©´ ê¸´ ê¸€ì´ ì™„ì„±ë©ë‹ˆë‹¤.</p>

        <div class="q-container">
            <div class="q-card">
                <span class="q-text">1. [ìƒí™©] ì–´ë–¤ ìƒí™©ì—ì„œ ê°ˆë“±ì´ ì‹œì‘ë˜ì—ˆë‚˜ìš”?</span>
                <p class="q-sub">(ìë™ ì™„ì„±ëœ ë¬¸ì¥ì…ë‹ˆë‹¤. í•„ìš”í•˜ë©´ ìˆ˜ì •í•˜ì„¸ìš”.)</p>
                <input type="text" id="ans1">
            </div>

            <div class="q-card">
                <span class="q-text">2. [ê³„ê¸°] ê·¸ë•Œ êµ¬ì²´ì ìœ¼ë¡œ ì–´ë–¤ ì¼ì´ ìˆì—ˆë‚˜ìš”?</span>
                <input type="text" id="ans2" placeholder="ì˜ˆ: ì œê°€ ê²Œì„ì„ í•˜ê³  ìˆëŠ”ë° ê°‘ìê¸° í°ì„ ëºìœ¼ì…¨ìŠµë‹ˆë‹¤.">
            </div>

            <div class="q-card">
                <span class="q-text">3. [ì†ë§ˆìŒ] ê·¸ë•Œ ë‚˜ì˜ ì†”ì§í•œ ìš•êµ¬(ë°”ë¨)ëŠ” ë¬´ì—‡ì´ì—ˆë‚˜ìš”?</span>
                <input type="text" id="ans3" placeholder="ì˜ˆ: ê³µë¶€í•˜ëŠë¼ í˜ë“¤ì–´ì„œ ë”± 10ë¶„ë§Œ ì‰¬ê³  ì‹¶ì—ˆìŠµë‹ˆë‹¤.">
            </div>

            <div class="q-card">
                <span class="q-text">4. [ë³€í™”] 'ë‚˜ ì „ë‹¬ë²•'ìœ¼ë¡œ ë§ì„ ë°”ê¾¸ë©´ì„œ ì–´ë–¤ ìƒê°ì´ ë“¤ì—ˆë‚˜ìš”?</span>
                <input type="text" id="ans4" placeholder="ì˜ˆ: ìš±í•˜ëŠ” ë§ˆìŒì„ ê°€ë¼ì•‰íˆê³  ì°¨ë¶„í•˜ê²Œ ë§í•˜ë ¤ê³  ë…¸ë ¥í–ˆìŠµë‹ˆë‹¤.">
            </div>

            <div class="q-card">
                <span class="q-text">5. [ë°˜ì‘] ë‚´ê°€ ë¶€ë“œëŸ½ê²Œ ë§í–ˆì„ ë•Œ ìƒëŒ€ë°©ì˜ ë°˜ì‘ì€ ì–´ë• ë‚˜ìš”?</span>
                <input type="text" id="ans5" placeholder="ì˜ˆ: ì—„ë§ˆë„ í™”ë¥¼ ë©ˆì¶”ê³  ì œ ì´ì•¼ê¸°ë¥¼ ë“¤ì–´ì£¼ì…¨ìŠµë‹ˆë‹¤.">
            </div>

            <div class="q-card">
                <span class="q-text">6. [ë‹¤ì§] ì´ë²ˆ í™œë™ì„ í†µí•´ ê¹¨ë‹¬ì€ ì ì´ë‚˜ ë‹¤ì§ì€?</span>
                <input type="text" id="ans6" placeholder="ì˜ˆ: ê°ì •ì ìœ¼ë¡œ ëŒ€ì²˜í•˜ê¸°ë³´ë‹¤ ëŒ€í™”ë¡œ í‘¸ëŠ” ê²ƒì´ ì¤‘ìš”í•¨ì„ ë°°ì› ìŠµë‹ˆë‹¤.">
            </div>
        </div>

        <button onclick="combineAnswers()">ğŸ“ ì—ì„¸ì´ ì´ˆì•ˆ ìƒì„±í•˜ê¸° ğŸ‘‰</button>
    </div>

    <div id="step4" class="step">
        <h2>STEP 4. ì´ˆì•ˆ ë‹¤ë“¬ê¸°</h2>
        <p>ë¬¸ì¥ë“¤ì´ í•©ì³ì¡ŒìŠµë‹ˆë‹¤. ì–´ìƒ‰í•œ ë¶€ë¶„ì„ ìˆ˜ì •í•´ ë³´ì„¸ìš”.</p>
        <textarea id="draftArea" style="height: 300px; line-height:1.6; padding:15px;"></textarea>
        
        <div style="display:flex; gap:10px;">
            <button class="btn-gray" onclick="goToStep(3)">ì´ì „</button>
            <button class="btn-green" onclick="aiTutorCheck()">ğŸ¤– AI ì„ ìƒë‹˜ ì²¨ì‚­</button>
        </div>
    </div>

    <div id="step5" class="step">
        <h2>STEP 5. ìµœì¢… í™•ì¸</h2>
        <div style="border:2px dashed #6C5CE7; padding:15px; background:#f8f9fa; border-radius:10px;">
            <span style="background:#6C5CE7; color:white; padding:3px 8px; border-radius:10px; font-size:0.8rem;">AI Teacher</span>
            <p style="font-size:0.9rem; margin-top:5px;">
                "ê¸€ì˜ êµ¬ì„±ì´ ë§¤ìš° íƒ„íƒ„í•©ë‹ˆë‹¤! [ìƒí™©-ì›ì¸-ê°ì •-ë³€í™”-ê²°ê³¼]ê°€ ë…¼ë¦¬ì ìœ¼ë¡œ ì´ì–´ì ¸ ìˆì–´, 
                ì½ëŠ” ì‚¬ëŒì—ê²Œ í•™ìƒì˜ ë§ˆìŒ ë³€í™”ê°€ ì˜ ì „ë‹¬ë©ë‹ˆë‹¤. í›Œë¥­í•´ìš”!"
            </p>
        </div>
        <textarea id="finalEssayArea" style="height: 250px; margin-top:10px;"></textarea>

        <button onclick="finalizeReport()">ğŸ“„ ìµœì¢… ë³´ê³ ì„œ ë°œí–‰</button>
    </div>

    <div id="step6" class="step">
        <h2>ìµœì¢… ê²°ê³¼ë¬¼</h2>
        
        <div id="finalReport" class="report-paper">
            <h2 style="text-align:center; border-bottom:2px solid #333; padding-bottom:10px;">EAIM í”„ë¡œì íŠ¸ ì„±ì°° ë³´ê³ ì„œ</h2>
            <div style="display:flex; justify-content:space-between; margin-bottom:20px;">
                <span>ê³¼ëª©: ê°€ì •</span>
                <span>í•™ë²ˆ: ________ ì´ë¦„: ________</span>
            </div>
            
            <div class="report-section">
                <div class="report-title">1. ê°ˆë“± ë¶„ì„ (Conflict Analysis)</div>
                <table style="width:100%; font-size:0.9rem; border-collapse:collapse;">
                    <tr>
                        <td style="padding:5px;"><strong>â€¢ ëŒ€ìƒ:</strong> <span id="repWho"></span></td>
                        <td style="padding:5px;"><strong>â€¢ ì›ì¸:</strong> <span id="repWhy"></span></td>
                    </tr>
                    <tr>
                        <td style="padding:5px;"><strong>â€¢ í–‰ë™:</strong> <span id="repAct"></span></td>
                        <td style="padding:5px;"><strong>â€¢ ê°ì •:</strong> <span id="repMood"></span></td>
                    </tr>
                </table>
            </div>

            <div class="report-section">
                <div class="report-title">2. ë‚˜ì˜ í•˜ëª¨ë‹ˆ (Lyrics)</div>
                <div style="background:#f9f9f9; padding:15px; border-radius:10px;">
                    <p><strong>[Verse: ê°ˆë“±ì˜ ë§ˆìŒ]</strong><br><span id="repVerse" style="white-space: pre-wrap; font-style:italic;"></span></p>
                    <hr style="border:1px dashed #ddd; margin:10px 0;">
                    <p><strong>[Chorus: í™”í•´ì˜ ë§ˆìŒ]</strong><br><span id="repChorus" style="white-space: pre-wrap; color:#00b894; font-weight:bold;"></span></p>
                </div>
            </div>

            <div class="report-section">
                <div class="report-title">3. ì„±ì°° ì—ì„¸ì´ (Reflection)</div>
                <p id="repEssay" style="line-height:1.8; text-align:justify; white-space: pre-wrap; font-size:1rem;"></p>
            </div>

            <div style="text-align:center; margin-top:30px; color:#aaa; font-size:0.8rem;">
                Family Harmony App - Deep Essay Edition
            </div>
        </div>

        <div class="no-print">
            <button class="btn-print" onclick="window.print()">ğŸ–¨ï¸ ì¸ì‡„ / PDF ì €ì¥</button>
            <button class="btn-print" onclick="saveAsImage()">ğŸ’¾ ì´ë¯¸ì§€ë¡œ ì €ì¥</button>
            <button class="btn-gray" onclick="goToStep(1)" style="margin-top:20px;">ì²˜ìŒìœ¼ë¡œ</button>
        </div>
    </div>

</div>

<script>
    let selWho = "", selWhy = "", selAct = "", selMood = "";

    function goToStep(num) {
        document.querySelectorAll('.step').forEach(e => e.classList.remove('active'));
        document.getElementById('step' + num).classList.add('active');
    }

    function selectTab(type, value, btn) {
        const group = btn.parentElement;
        group.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('selected'));
        btn.classList.add('selected');

        if (type === 'who') selWho = value;
        if (type === 'why') selWhy = value;
        if (type === 'act') selAct = value;
        if (type === 'mood') {
            selMood = value;
            updateMutoFace(value);
        }
        updateSceneText();
    }

    function updateMutoFace(mood) {
        const face = document.getElementById('mutoFace');
        const earL = document.getElementById('mutoEarL');
        const earR = document.getElementById('mutoEarR');
        face.style.backgroundColor = "#ffeaa7"; earL.style.backgroundColor = "#ffeaa7"; earR.style.backgroundColor = "#ffeaa7";
        face.style.transform = "scale(1)";

        if (mood === 'í™”ë‚¨') {
            face.innerText = "ğŸ˜¡"; face.style.backgroundColor = "#ff7675"; earL.style.backgroundColor = "#ff7675"; earR.style.backgroundColor = "#ff7675"; face.style.transform = "scale(1.1)";
        } else if (mood === 'ì–µìš¸í•¨') {
            face.innerText = "ğŸ˜¤"; face.style.backgroundColor = "#fab1a0"; earL.style.backgroundColor = "#fab1a0"; earR.style.backgroundColor = "#fab1a0";
        } else if (mood === 'ìŠ¬í””') {
            face.innerText = "ğŸ˜¢"; face.style.backgroundColor = "#74b9ff"; earL.style.backgroundColor = "#74b9ff"; earR.style.backgroundColor = "#74b9ff";
        } else if (mood === 'ë‹µë‹µí•¨') {
            face.innerText = "ğŸ˜©"; face.style.backgroundColor = "#b2bec3"; earL.style.backgroundColor = "#b2bec3"; earR.style.backgroundColor = "#b2bec3";
        }
    }

    function getJosa(word, type) {
        const lastChar = word.charCodeAt(word.length - 1);
        const hasJongseong = (lastChar - 0xAC00) % 28 > 0;
        if (type === 'iga') return hasJongseong ? 'ì´' : 'ê°€';
        return '';
    }

    function updateSceneText() {
        const txt = document.getElementById('mutoText');
        if(selWho && selWhy && selAct && selMood) {
            const josa = getJosa(selWho, 'iga'); 
            txt.innerText = `${selWho}${josa} ${selWhy} ë•Œë¬¸ì— ${selAct} ${selMood}`;
            document.getElementById('ans1').value = `ì €ëŠ” ìµœê·¼ ê°€ì •ì—ì„œ ${selWho}${josa} ${selWhy} ë•Œë¬¸ì— ì €ë¥¼(ì—ê²Œ) ${selAct} ${selMood}ì„(ë¥¼) ëŠê¼ˆìŠµë‹ˆë‹¤.`;
        } else {
            txt.innerText = "ì¡°ê°ì„ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”";
        }
    }

    function aiLyrics() {
        if(!selWho || !selWhy || !selAct || !selMood) { alert("ìƒí™© ì¡°ê°ì„ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”!"); return; }
        const sharp = document.getElementById('sharpInput').value;
        const round = document.getElementById('roundInput').value;
        if(!sharp || !round) { alert("ë§í’ì„  ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”."); return; }

        const verse = `ë¬¸ì œëŠ” "${selWhy}"\n"${sharp}"\n${selAct} ë‹«í˜€ë²„ë¦° ë‚´ ë§ˆìŒ`;
        const chorus = `í•˜ì§€ë§Œ ë‹¤ì‹œ ìš©ê¸° ë‚´ì–´ ë§í• ê²Œ\n"${round}"\n${selWho}ì—ê²Œ ì „í•˜ëŠ” ë‚˜ì˜ ì§„ì‹¬`;

        document.getElementById('verseArea').value = verse;
        document.getElementById('chorusArea').value = chorus;
        document.getElementById('displaySituation').innerText = `${selWho} / ${selWhy} / ${selAct}`;
        goToStep(2);
    }

    // [í•µì‹¬] 6ê°œ ì§ˆë¬¸ í•©ì¹˜ê¸° ë¡œì§
    function combineAnswers() {
        const a1 = document.getElementById('ans1').value; // ìƒí™©
        const a2 = document.getElementById('ans2').value; // ê³„ê¸°
        const a3 = document.getElementById('ans3').value; // ìš•êµ¬
        const a4 = document.getElementById('ans4').value; // ë³€í™”
        const a5 = document.getElementById('ans5').value; // ë°˜ì‘
        const a6 = document.getElementById('ans6').value; // ë‹¤ì§

        if(!a1 || !a2 || !a3 || !a4 || !a5 || !a6) { alert("6ê°€ì§€ ì§ˆë¬¸ì— ëª¨ë‘ ë‹µí•´ì£¼ì„¸ìš”. ì§§ê²Œë¼ë„ ê´œì°®ìŠµë‹ˆë‹¤!"); return; }

        const draft = 
`${a1}

êµ¬ì²´ì ìœ¼ë¡œ ì´ì•¼ê¸°í•˜ìë©´, ${a2}

ê·¸ ë‹¹ì‹œ ì €ì˜ ì†”ì§í•œ ë§ˆìŒ ì† ìš•êµ¬ëŠ” ${a3}

ê°ì •ì ìœ¼ë¡œ ëŒ€ì‘í•˜ëŠ” ëŒ€ì‹ , ìˆ˜ì—… ì‹œê°„ì— ë°°ìš´ 'ë‚˜ ì „ë‹¬ë²•'ì„ ì‚¬ìš©í•˜ì—¬ ë§ì„ ë°”ê¾¸ì–´ ë³´ì•˜ìŠµë‹ˆë‹¤. ${a4}

ê·¸ë ‡ê²Œ ì§„ì‹¬ì„ ì „í•˜ì, ë†€ëê²Œë„ ${a5}

ì´ë²ˆ EAIM í”„ë¡œì íŠ¸ í™œë™ì„ í†µí•´ ì €ëŠ” ${a6}`;

        document.getElementById('draftArea').value = draft;
        goToStep(4);
    }

    function aiTutorCheck() {
        const draft = document.getElementById('draftArea').value;
        document.getElementById('finalEssayArea').value = draft; 
        goToStep(5);
    }

    function finalizeReport() {
        document.getElementById('repWho').innerText = selWho;
        document.getElementById('repWhy').innerText = selWhy;
        document.getElementById('repAct').innerText = selAct;
        document.getElementById('repMood').innerText = selMood;
        document.getElementById('repVerse').innerText = document.getElementById('verseArea').value;
        document.getElementById('repChorus').innerText = document.getElementById('chorusArea').value;
        document.getElementById('repEssay').innerText = document.getElementById('finalEssayArea').value;
        goToStep(6);
    }

    function saveAsImage() {
        const report = document.getElementById("finalReport");
        html2canvas(report).then(canvas => {
            const link = document.createElement("a");
            link.download = "ê°€ì •ìˆ˜í–‰í‰ê°€_ì„±ì°°ë³´ê³ ì„œ.png";
            link.href = canvas.toDataURL();
            link.click();
        });
    }
</script>

</body>
</html>