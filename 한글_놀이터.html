<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>EAIM ÌïúÍ∏Ä ÎÜÄÏù¥ÌÑ∞ (ÏôïÍ∏ÄÏî® Î≤ÑÏ†Ñ)</title>
    
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Jua&family=Gaegu:wght@700&family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; background-color: #FDF4FF; user-select: none; }
        .font-title { font-family: 'Jua', sans-serif; }
        .font-hand { font-family: 'Gaegu', cursive; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        
        /* Ïπ¥Îìú Ïä§ÌÉÄÏùº */
        .letter-card { 
            transition: all 0.2s cubic-bezier(0.34, 1.56, 0.64, 1); 
            cursor: pointer;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border-bottom-width: 6px; 
        }
        .letter-card:active { transform: scale(0.96); border-bottom-width: 2px; transform: translateY(4px); }
        .letter-card:hover { transform: translateY(-3px); box-shadow: 0 15px 20px -5px rgba(192, 38, 211, 0.2); border-color: #d946ef; }
        
        /* ÌÉ≠ Î≤ÑÌäº Ïä§ÌÉÄÏùº */
        .tab-btn { transition: all 0.2s; border-bottom-width: 4px; }
        .tab-btn.active { background-color: #9333EA; color: white; border-color: #6B21A8; transform: translateY(-2px); }
        .tab-btn.inactive { background-color: white; color: #7E22CE; border-color: #E9D5FF; }
        .tab-btn:active { transform: translateY(0); border-bottom-width: 2px; }

        /* Ï∫îÎ≤ÑÏä§ Î∞∞Í≤Ω */
        #drawingCanvas {
            touch-action: none;
            background-image: radial-gradient(#E9D5FF 2px, transparent 2px);
            background-size: 30px 30px;
            cursor: crosshair;
        }

        .stamp-mark {
            animation: stamp-land 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
            opacity: 0; transform: scale(2) rotate(-15deg);
        }
        @keyframes stamp-land {
            to { opacity: 1; transform: scale(1) rotate(-15deg); }
        }

        .animate-bounce-slow { animation: bounce 2s infinite; }
        
        /* Î™®Îã¨ Ïï†ÎãàÎ©îÏù¥ÏÖò */
        @keyframes popIn {
            0% { opacity: 0; transform: scale(0.8); }
            100% { opacity: 1; transform: scale(1); }
        }
        .animate-pop { animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
    </style>
</head>
<body class="bg-fuchsia-50 min-h-screen text-lg">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef, useEffect } = React;

        // --- Îç∞Ïù¥ÌÑ∞ ---
        const consonants = [
            { char: '„Ñ±', name: 'Í∏∞Ïó≠', word: 'Í∞ÄÎ∞©', img: 'üéí', uzb: 'Sumka', viet: 'C·∫∑p' },
            { char: '„Ñ¥', name: 'ÎãàÏùÄ', word: 'ÎÇòÎπÑ', img: 'ü¶ã', uzb: 'Kapalak', viet: 'Con b∆∞·ªõm' },
            { char: '„Ñ∑', name: 'ÎîîÍ∑ø', word: 'Îã§ÎûåÏ•ê', img: 'üêøÔ∏è', uzb: 'Olmaxon', viet: 'S√≥c' },
            { char: '„Ñπ', name: 'Î¶¨ÏùÑ', word: 'ÎùºÎîîÏò§', img: 'üìª', uzb: 'Radio', viet: 'ƒê√†i radio' },
            { char: '„ÖÅ', name: 'ÎØ∏Ïùå', word: 'Î™®Ïûê', img: 'üß¢', uzb: 'Shlyapa', viet: 'M≈©' },
            { char: '„ÖÇ', name: 'ÎπÑÏùç', word: 'Î≤ÑÏä§', img: 'üöå', uzb: 'Avtobus', viet: 'Xe bu√Ωt' },
            { char: '„ÖÖ', name: 'ÏãúÏò∑', word: 'ÏÇ¨Í≥º', img: 'üçé', uzb: 'Olma', viet: 'T√°o' },
            { char: '„Öá', name: 'Ïù¥Ïùë', word: 'ÏïÑÍ∏∞', img: 'üë∂', uzb: 'Chaqaloq', viet: 'Em b√©' },
            { char: '„Öà', name: 'ÏßÄÏùí', word: 'ÏûêÏ†ÑÍ±∞', img: 'üö≤', uzb: 'Velosiped', viet: 'Xe ƒë·∫°p' },
            { char: '„Öä', name: 'ÏπòÏùì', word: 'ÏπòÎßà', img: 'üëó', uzb: 'Yubka', viet: 'V√°y' },
            { char: '„Öã', name: 'ÌÇ§Ïùî', word: 'Ïπ¥Î©îÎùº', img: 'üì∑', uzb: 'Kamera', viet: 'M√°y ·∫£nh' },
            { char: '„Öå', name: 'Ìã∞Ïùï', word: 'ÌÜ†ÎßàÌÜ†', img: 'üçÖ', uzb: 'Pomidor', viet: 'C√† chua' },
            { char: '„Öç', name: 'ÌîºÏùñ', word: 'ÌîºÏûê', img: 'üçï', uzb: 'Pitsa', viet: 'B√°nh pizza' },
            { char: '„Öé', name: 'ÌûàÏùó', word: 'ÌïôÍµê', img: 'üè´', uzb: 'Maktab', viet: 'Tr∆∞·ªùng h·ªçc' }
        ];

        const vowels = [
            { char: '„Öè', name: 'ÏïÑ', word: 'ÏïÑÏù¥', img: 'üßí', uzb: 'Bola', viet: 'Tr·∫ª em' },
            { char: '„Öë', name: 'Ïïº', word: 'ÏïºÍµ¨', img: '‚öæ', uzb: 'Beysbol', viet: 'B√≥ng ch√†y' },
            { char: '„Öì', name: 'Ïñ¥', word: 'Ïñ¥Î®∏Îãà', img: 'üë©', uzb: 'Ona', viet: 'M·∫π' },
            { char: '„Öï', name: 'Ïó¨', word: 'Ïó¨Ïö∞', img: 'ü¶ä', uzb: 'Tulki', viet: 'Con c√°o' },
            { char: '„Öó', name: 'Ïò§', word: 'Ïò§Ïù¥', img: 'ü•í', uzb: 'Bodring', viet: 'D∆∞a chu·ªôt' },
            { char: '„Öõ', name: 'Ïöî', word: 'ÏöîÎ¶¨', img: 'üç≥', uzb: 'Ovqat pishirish', viet: 'N·∫•u ƒÉn' },
            { char: '„Öú', name: 'Ïö∞', word: 'Ïö∞Ïú†', img: 'ü•õ', uzb: 'Sut', viet: 'S·ªØa' },
            { char: '„Ö†', name: 'Ïú†', word: 'Ïú†Î¶¨', img: 'ü™ü', uzb: 'Shisha', viet: 'K√≠nh' },
            { char: '„Ö°', name: 'Ïúº', word: 'ÏúºÎ•¥Î†Å', img: 'ü¶Å', uzb: 'Irillash', viet: 'G·∫ßm g·ª´' },
            { char: '„Ö£', name: 'Ïù¥', word: 'Ïù¥', img: 'ü¶∑', uzb: 'Tish', viet: 'RƒÉng' }
        ];

        const App = () => {
            const [activeTab, setActiveTab] = useState('consonant');
            const [selectedItem, setSelectedItem] = useState(null);
            const [stamps, setStamps] = useState({}); 
            const [quizMode, setQuizMode] = useState(false);
            const [quizItem, setQuizItem] = useState(null);
            const [quizMessage, setQuizMessage] = useState('');
            const [voiceList, setVoiceList] = useState([]);

            const canvasRef = useRef(null);
            const [isDrawing, setIsDrawing] = useState(false);

            // ÌÉ≠ Îç∞Ïù¥ÌÑ∞
            const currentData = activeTab === 'consonant' ? consonants : vowels;

            // --- Î™©ÏÜåÎ¶¨ Î°úÎî© ---
            useEffect(() => {
                const loadVoices = () => {
                    const voices = window.speechSynthesis.getVoices();
                    setVoiceList(voices);
                };
                loadVoices();
                if (window.speechSynthesis.onvoiceschanged !== undefined) {
                    window.speechSynthesis.onvoiceschanged = loadVoices;
                }
            }, []);

            // --- ÏÜåÎ¶¨ Ïû¨ÏÉù ---
            const playSound = (text, rate = 0.8) => {
                if (!window.speechSynthesis) return;
                window.speechSynthesis.cancel();
                
                const utter = new SpeechSynthesisUtterance(text);
                utter.lang = 'ko-KR';
                utter.rate = rate;
                
                let availableVoices = voiceList.length > 0 ? voiceList : window.speechSynthesis.getVoices();
                const korVoice = availableVoices.find(v => 
                    v.lang.includes('ko') || v.name.includes('Korean') || v.name.includes('ÌïúÍµ≠')
                );

                if (korVoice) utter.voice = korVoice;
                window.speechSynthesis.speak(utter);
            };

            // Î™®Îã¨ Ïó¥Í∏∞
            const openModal = (item) => {
                if (quizMode) {
                    checkQuiz(item);
                } else {
                    setSelectedItem(item);
                    // ÏûêÎèô ÏÜåÎ¶¨ Ïû¨ÏÉù Ï†úÍ±∞ (initCanvasÎßå ÏàòÌñâ)
                    setTimeout(() => {
                        initCanvas();
                    }, 50);
                }
            };

            // Ï∫îÎ≤ÑÏä§ Ï¥àÍ∏∞Ìôî
            const initCanvas = () => {
                const canvas = canvasRef.current;
                if (!canvas) return;
                setTimeout(() => {
                    const rect = canvas.parentElement.getBoundingClientRect();
                    canvas.width = rect.width;
                    canvas.height = rect.height;
                    const ctx = canvas.getContext('2d');
                    ctx.clearRect(0,0,canvas.width, canvas.height);
                }, 50);
            };

            // Í∑∏Î¶¨Í∏∞ Î°úÏßÅ
            const startDrawing = (e) => {
                const canvas = canvasRef.current;
                if(!canvas) return;
                setIsDrawing(true);
                const ctx = canvas.getContext('2d');
                const rect = canvas.getBoundingClientRect();
                const x = (e.touches ? e.touches[0].clientX : e.clientX) - rect.left;
                const y = (e.touches ? e.touches[0].clientY : e.clientY) - rect.top;
                ctx.beginPath();
                ctx.moveTo(x, y);
                ctx.lineWidth = 20; 
                ctx.lineCap = 'round';
                ctx.lineJoin = 'round';
                ctx.strokeStyle = 'rgba(147, 51, 234, 0.6)'; 
            };

            const draw = (e) => {
                if (!isDrawing) return;
                const canvas = canvasRef.current;
                const ctx = canvas.getContext('2d');
                const rect = canvas.getBoundingClientRect();
                const x = (e.touches ? e.touches[0].clientX : e.clientX) - rect.left;
                const y = (e.touches ? e.touches[0].clientY : e.clientY) - rect.top;
                ctx.lineTo(x, y);
                ctx.stroke();
            };

            // Ïì∞Í∏∞ ÏôÑÎ£å
            const finishWriting = () => {
                if (!selectedItem) return;
                setStamps(prev => ({ ...prev, [selectedItem.char]: true }));
                confetti({ particleCount: 120, spread: 80, origin: { y: 0.6 }, colors: ['#A855F7', '#EC4899', '#FBBF24'] });
                playSound("Ï∞∏ ÏûòÌñàÏñ¥Ïöî!");
                setTimeout(() => setSelectedItem(null), 1500);
            };

            // ÌÄ¥Ï¶à
            const startQuiz = () => {
                setQuizMode(true);
                setQuizMessage("ÏÜåÎ¶¨Î•º Îì£Í≥† Ïπ¥ÎìúÎ•º Ï∞æÏïÑÎ≥¥ÏÑ∏Ïöî!");
                setTimeout(() => nextQuiz(), 1000);
            };
            const nextQuiz = () => {
                const target = currentData[Math.floor(Math.random() * currentData.length)];
                setQuizItem(target);
                setQuizMessage(`"${target.word}"ÏùÄ Ïñ¥Îîî ÏûàÏùÑÍπåÏöî?`);
                playSound(`${target.word}. ${target.word}Îäî Ïñ¥Îîî ÏûàÏùÑÍπåÏöî?`);
            };
            const checkQuiz = (item) => {
                if (item.char === quizItem.char) {
                    confetti({ particleCount: 50, spread: 50 });
                    playSound("Ï†ïÎãµÏûÖÎãàÎã§! Ï∞∏ ÏûòÌñàÏñ¥Ïöî.");
                    setQuizMessage("Ï†ïÎãµ! üéâ");
                    setTimeout(() => nextQuiz(), 1500);
                } else {
                    playSound("Îã§Ïãú ÌïúÎ≤à ÏÉùÍ∞ÅÌï¥Î≥¥ÏÑ∏Ïöî.");
                    setQuizMessage("Îï°! Îã§Ïãú Ï∞æÏïÑÎ≥¥ÏÑ∏Ïöî ü§î");
                }
            };
            const exitQuiz = () => {
                setQuizMode(false);
                setQuizItem(null);
                setQuizMessage("");
            };

            return (
                <div className="max-w-xl mx-auto min-h-screen bg-white shadow-2xl flex flex-col relative border-x-2 border-purple-100">
                    
                    {/* Header (Sticky) */}
                    <header className={`sticky top-0 z-40 p-6 text-white shadow-xl rounded-b-[2rem] transition-colors duration-300 ${quizMode ? 'bg-indigo-600' : 'bg-gradient-to-r from-purple-500 to-pink-500'}`}>
                        <div className="flex justify-between items-center">
                            <div>
                                <h1 className="text-3xl font-bold font-title flex items-center drop-shadow-md">
                                    <span className="mr-3 text-4xl">{quizMode ? 'üéÆ' : 'üê£'}</span> 
                                    {quizMode ? 'Îã®Ïñ¥ Ï∞æÍ∏∞ Í≤åÏûÑ!' : 'EAIM ÌïúÍ∏Ä ÎÜÄÏù¥ÌÑ∞'}
                                </h1>
                                <p className="text-sm text-purple-100 font-medium ml-1 mt-1 font-hand tracking-wider">
                                    {quizMode ? 'Listen and find the card!' : "Korean / O'zbek / Ti·∫øng Vi·ªát"}
                                </p>
                            </div>
                            {quizMode && (
                                <button onClick={exitQuiz} className="bg-white/20 px-4 py-2 rounded-xl text-sm font-bold hover:bg-white/30 border-2 border-white/20">ÎÇòÍ∞ÄÍ∏∞</button>
                            )}
                        </div>
                        {quizMode && (
                            <div className="mt-4 bg-white/10 p-4 rounded-2xl text-center animate-bounce-slow border-2 border-white/20">
                                <p className="text-2xl font-bold text-yellow-300 shadow-sm font-title">{quizMessage}</p>
                                <button onClick={() => playSound(`${quizItem.word}. ${quizItem.word}Îäî Ïñ¥Îîî ÏûàÏùÑÍπåÏöî?`)} className="mt-3 text-base bg-white/20 px-4 py-2 rounded-full font-bold hover:bg-white/30 transition">
                                    <i className="fa-solid fa-volume-high mr-2"></i> Îã§Ïãú Îì£Í∏∞
                                </button>
                            </div>
                        )}
                        
                        {/* Tabs */}
                        {!quizMode && (
                            <div className="mt-6 flex gap-3 justify-center">
                                <button onClick={() => setActiveTab('consonant')} className={`tab-btn flex-1 py-4 rounded-2xl font-bold text-xl font-title border-2 shadow-sm ${activeTab === 'consonant' ? 'active' : 'inactive'}`}>
                                    ÏûêÏùå („Ñ±~„Öé)
                                </button>
                                <button onClick={() => setActiveTab('vowel')} className={`tab-btn flex-1 py-4 rounded-2xl font-bold text-xl font-title border-2 shadow-sm ${activeTab === 'vowel' ? 'active' : 'inactive'}`}>
                                    Î™®Ïùå („Öè~„Ö£)
                                </button>
                            </div>
                        )}
                    </header>

                    {/* Content */}
                    <div className="p-6 pb-32">
                        <div className="grid grid-cols-2 gap-4">
                            {currentData.map((item) => (
                                <div key={item.char} onClick={() => openModal(item)} 
                                     className={`letter-card bg-white rounded-[2rem] p-4 flex flex-col items-center justify-center border-4 h-56 relative ${quizMode ? 'hover:bg-indigo-50 border-indigo-100' : 'border-purple-50'}`}>
                                    
                                    {!quizMode && stamps[item.char] && (
                                        <div className="absolute top-2 right-2 stamp-mark pointer-events-none">
                                            <i className="fa-solid fa-stamp text-pink-500 text-4xl opacity-50"></i>
                                        </div>
                                    )}

                                    <span className="text-7xl font-bold text-gray-800 font-title mb-3 mt-1">{item.char}</span>
                                    <div className="flex flex-col items-center gap-1">
                                        <span className="text-4xl mb-1">{item.img}</span>
                                        <span className="text-xl font-bold text-gray-500 font-title">{item.word}</span>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>

                    {/* Game Start Button (Fixed) */}
                    {!quizMode && (
                        <div className="fixed bottom-8 right-6 z-30">
                            <button onClick={startQuiz} className="bg-gradient-to-br from-yellow-400 to-orange-500 text-white w-20 h-20 rounded-[2rem] shadow-2xl flex items-center justify-center text-4xl animate-bounce hover:scale-110 transition-transform border-4 border-white">
                                üéÆ
                            </button>
                        </div>
                    )}

                    {/* Learning Modal (Ïä§ÌÅ¨Î°§ Í∞ÄÎä•, ÏûêÎèôÏÜåÎ¶¨ X) */}
                    {selectedItem && (
                        <div className="fixed inset-0 z-50 overflow-y-auto bg-black/80 backdrop-blur-md">
                            <div className="flex min-h-full items-center justify-center p-4">
                                <div className="bg-white rounded-[2.5rem] w-full max-w-lg shadow-2xl overflow-hidden animate-pop relative border-4 border-purple-200">
                                    {/* Close */}
                                    <button onClick={() => setSelectedItem(null)} className="absolute top-6 right-6 text-gray-300 hover:text-gray-500 z-20 text-4xl bg-white rounded-full p-1 shadow-sm">
                                        <i className="fa-solid fa-times-circle"></i>
                                    </button>

                                    <div className="p-8 flex flex-col items-center">
                                        {/* Top Section */}
                                        <div className="flex items-center gap-6 mb-6 w-full justify-center mt-4">
                                            <span className="text-9xl font-bold text-purple-600 font-title drop-shadow-sm">{selectedItem.char}</span>
                                            <div className="flex flex-col gap-3">
                                                <button onClick={() => playSound(selectedItem.char)} className="w-16 h-16 bg-purple-100 text-purple-600 rounded-2xl flex items-center justify-center hover:bg-purple-200 shadow-md active:scale-95 transition-transform border-b-4 border-purple-300 active:border-b-0 active:translate-y-1">
                                                    <i className="fa-solid fa-volume-high text-2xl"></i>
                                                </button>
                                                <button onClick={() => playSound(selectedItem.word)} className="w-16 h-16 bg-pink-100 text-pink-600 rounded-2xl flex items-center justify-center hover:bg-pink-200 shadow-md active:scale-95 transition-transform border-b-4 border-pink-300 active:border-b-0 active:translate-y-1">
                                                    <i className="fa-solid fa-comment-dots text-2xl"></i>
                                                </button>
                                            </div>
                                        </div>

                                        {/* Canvas Area */}
                                        <div className="relative w-full aspect-square bg-purple-50 rounded-[2rem] border-4 border-purple-200 mb-6 overflow-hidden shadow-inner">
                                            <div className="absolute inset-0 flex items-center justify-center text-[280px] font-title text-purple-200/40 pointer-events-none select-none">
                                                {selectedItem.char}
                                            </div>
                                            <canvas ref={canvasRef} className="w-full h-full block touch-none"
                                                onMouseDown={startDrawing} onMouseMove={draw} onMouseUp={() => setIsDrawing(false)} onMouseLeave={() => setIsDrawing(false)}
                                                onTouchStart={startDrawing} onTouchMove={draw} onTouchEnd={() => setIsDrawing(false)}
                                            />
                                            <button onClick={initCanvas} className="absolute bottom-4 right-4 bg-white p-3 rounded-2xl shadow-lg text-gray-400 hover:text-red-500 text-xl z-10 border-2 border-gray-100">
                                                <i className="fa-solid fa-eraser"></i>
                                            </button>
                                        </div>

                                        {/* Word Card */}
                                        <div className="w-full bg-pink-50 rounded-[1.5rem] p-5 flex items-center gap-5 mb-6 border-2 border-pink-100">
                                            <span className="text-6xl">{selectedItem.img}</span>
                                            <div className="flex-1">
                                                <div className="font-bold text-3xl text-gray-800 mb-1 font-title">{selectedItem.word}</div>
                                                <div className="flex flex-col text-sm text-gray-600 font-medium space-y-1">
                                                    <span className="flex items-center gap-2 bg-white/50 px-2 py-1 rounded-lg w-fit">üá∫üáø <span className="text-lg">{selectedItem.uzb}</span></span>
                                                    <span className="flex items-center gap-2 bg-white/50 px-2 py-1 rounded-lg w-fit">üáªüá≥ <span className="text-lg">{selectedItem.viet}</span></span>
                                                </div>
                                            </div>
                                            <button onClick={() => playSound(selectedItem.word)} className="text-pink-400 hover:text-pink-600 text-3xl p-3">
                                                <i className="fa-solid fa-volume-high"></i>
                                            </button>
                                        </div>

                                        {/* Finish Button */}
                                        <button onClick={finishWriting} className="w-full bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white py-5 rounded-2xl font-bold text-2xl shadow-xl shadow-purple-200 transition transform active:scale-95 flex items-center justify-center gap-3 border-b-8 border-purple-700 active:border-b-0 active:translate-y-2 font-title mb-2">
                                            <span>Îã§ ÏçºÏñ¥Ïöî!</span> <i className="fa-solid fa-check"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>