<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>EAIM ÌïúÍ∏Ä ÎÜÄÏù¥ÌÑ∞ (Fun Mode)</title>
    
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Jua&family=Gaegu:wght@700&family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; background-color: #FDF4FF; user-select: none; }
        .font-title { font-family: 'Jua', sans-serif; }
        .font-hand { font-family: 'Gaegu', cursive; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        
        .letter-card { 
            transition: all 0.2s cubic-bezier(0.34, 1.56, 0.64, 1); 
            cursor: pointer;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        .letter-card:active { transform: scale(0.9); }
        .letter-card:hover { transform: translateY(-5px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
        
        .tab-btn.active { background-color: #D946EF; color: white; border-color: #D946EF; transform: translateY(-2px); box-shadow: 0 4px 0 #A21CAF; }
        .tab-btn.inactive { background-color: white; color: #86198F; border-color: #F0ABFC; }
        .tab-btn:active { transform: translateY(0); box-shadow: none; }

        #drawingCanvas {
            touch-action: none;
            background-image: radial-gradient(#E9D5FF 2px, transparent 2px);
            background-size: 24px 24px;
            cursor: crosshair;
        }

        .stamp-mark {
            animation: stamp-land 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
            opacity: 0; transform: scale(2) rotate(-15deg);
        }
        @keyframes stamp-land {
            to { opacity: 1; transform: scale(1) rotate(-15deg); }
        }

        .animate-bounce-slow { animation: bounce 2s infinite; }
    </style>
</head>
<body class="bg-fuchsia-50 min-h-screen">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef, useEffect } = React;

        // --- Îç∞Ïù¥ÌÑ∞ (Ïö∞Ï¶àÎ≤°Ïñ¥, Î≤†Ìä∏ÎÇ®Ïñ¥ Ìè¨Ìï®) ---
        const consonants = [
            { char: '„Ñ±', name: 'Í∏∞Ïó≠', word: 'Í∞ÄÎ∞©', img: 'üéí', uzb: 'Sumka', viet: 'C·∫∑p' },
            { char: '„Ñ¥', name: 'ÎãàÏùÄ', word: 'ÎÇòÎπÑ', img: 'ü¶ã', uzb: 'Kapalak', viet: 'Con b∆∞·ªõm' },
            { char: '„Ñ∑', name: 'ÎîîÍ∑ø', word: 'Îã§ÎûåÏ•ê', img: 'üêøÔ∏è', uzb: 'Olmaxon', viet: 'S√≥c' },
            { char: '„Ñπ', name: 'Î¶¨ÏùÑ', word: 'ÎùºÎîîÏò§', img: 'üìª', uzb: 'Radio', viet: 'ƒê√†i radio' },
            { char: '„ÖÅ', name: 'ÎØ∏Ïùå', word: 'Î™®Ïûê', img: 'üß¢', uzb: 'Shlyapa', viet: 'M≈©' },
            { char: '„ÖÇ', name: 'ÎπÑÏùç', word: 'Î≤ÑÏä§', img: 'üöå', uzb: 'Avtobus', viet: 'Xe bu√Ωt' },
            { char: '„ÖÖ', name: 'ÏãúÏò∑', word: 'ÏÇ¨Í≥º', img: 'üçé', uzb: 'Olma', viet: 'T√°o' },
            { char: '„Öá', name: 'Ïù¥Ïùë', word: 'ÏïÑÍ∏∞', img: 'üë∂', uzb: 'Chaqaloq', viet: 'Em b√©' },
            { char: '„Öà', name: 'ÏßÄÏùí', word: 'ÏûêÏ†ÑÍ±∞', img: 'üö≤', uzb: 'Velosiped', viet: 'Xe ƒë·∫°p' },
            { char: '„Öä', name: 'ÏπòÏùì', word: 'ÏπòÎßà', img: 'üëó', uzb: 'Yubka', viet: 'V√°y' },
            { char: '„Öã', name: 'ÌÇ§Ïùî', word: 'Ïπ¥Î©îÎùº', img: 'üì∑', uzb: 'Kamera', viet: 'M√°y ·∫£nh' },
            { char: '„Öå', name: 'Ìã∞Ïùï', word: 'ÌÜ†ÎßàÌÜ†', img: 'üçÖ', uzb: 'Pomidor', viet: 'C√† chua' },
            { char: '„Öç', name: 'ÌîºÏùñ', word: 'ÌîºÏûê', img: 'üçï', uzb: 'Pitsa', viet: 'B√°nh pizza' },
            { char: '„Öé', name: 'ÌûàÏùó', word: 'ÌïôÍµê', img: 'üè´', uzb: 'Maktab', viet: 'Tr∆∞·ªùng h·ªçc' }
        ];

        const vowels = [
            { char: '„Öè', name: 'ÏïÑ', word: 'ÏïÑÏù¥', img: 'üßí', uzb: 'Bola', viet: 'Tr·∫ª em' },
            { char: '„Öë', name: 'Ïïº', word: 'ÏïºÍµ¨', img: '‚öæ', uzb: 'Beysbol', viet: 'B√≥ng ch√†y' },
            { char: '„Öì', name: 'Ïñ¥', word: 'Ïñ¥Î®∏Îãà', img: 'üë©', uzb: 'Ona', viet: 'M·∫π' },
            { char: '„Öï', name: 'Ïó¨', word: 'Ïó¨Ïö∞', img: 'ü¶ä', uzb: 'Tulki', viet: 'Con c√°o' },
            { char: '„Öó', name: 'Ïò§', word: 'Ïò§Ïù¥', img: 'ü•í', uzb: 'Bodring', viet: 'D∆∞a chu·ªôt' },
            { char: '„Öõ', name: 'Ïöî', word: 'ÏöîÎ¶¨', img: 'üç≥', uzb: 'Ovqat pishirish', viet: 'N·∫•u ƒÉn' },
            { char: '„Öú', name: 'Ïö∞', word: 'Ïö∞Ïú†', img: 'ü•õ', uzb: 'Sut', viet: 'S·ªØa' },
            { char: '„Ö†', name: 'Ïú†', word: 'Ïú†Î¶¨', img: 'ü™ü', uzb: 'Shisha', viet: 'K√≠nh' },
            { char: '„Ö°', name: 'Ïúº', word: 'ÏúºÎ•¥Î†Å', img: 'ü¶Å', uzb: 'Irillash', viet: 'G·∫ßm g·ª´' },
            { char: '„Ö£', name: 'Ïù¥', word: 'Ïù¥', img: 'ü¶∑', uzb: 'Tish', viet: 'RƒÉng' }
        ];

        const App = () => {
            const [activeTab, setActiveTab] = useState('consonant');
            const [selectedItem, setSelectedItem] = useState(null);
            const [stamps, setStamps] = useState({}); // { '„Ñ±': true, '„Ñ¥': true ... }
            const [quizMode, setQuizMode] = useState(false);
            const [quizItem, setQuizItem] = useState(null);
            const [quizMessage, setQuizMessage] = useState('');

            const canvasRef = useRef(null);
            const [isDrawing, setIsDrawing] = useState(false);

            // ÌÉ≠ Ï†ÑÌôò
            const currentData = activeTab === 'consonant' ? consonants : vowels;

            // ÏÜåÎ¶¨ Ïû¨ÏÉù
            const playSound = (text, rate = 0.8) => {
                window.speechSynthesis.cancel();
                const utter = new SpeechSynthesisUtterance(text);
                utter.lang = 'ko-KR';
                utter.rate = rate;
                window.speechSynthesis.speak(utter);
            };

            // Î™®Îã¨ Ïó¥Í∏∞
            const openModal = (item) => {
                if (quizMode) {
                    checkQuiz(item);
                } else {
                    setSelectedItem(item);
                    setTimeout(() => {
                        playSound(item.char);
                        setTimeout(() => playSound(item.word), 800);
                        initCanvas();
                    }, 100);
                }
            };

            // Ï∫îÎ≤ÑÏä§ Ï¥àÍ∏∞Ìôî
            const initCanvas = () => {
                const canvas = canvasRef.current;
                if (!canvas) return;
                const rect = canvas.parentElement.getBoundingClientRect();
                canvas.width = rect.width;
                canvas.height = rect.height;
                const ctx = canvas.getContext('2d');
                ctx.clearRect(0,0,canvas.width, canvas.height);
            };

            // Ï∫îÎ≤ÑÏä§ Í∑∏Î¶¨Í∏∞ Î°úÏßÅ
            const startDrawing = (e) => {
                const canvas = canvasRef.current;
                if(!canvas) return;
                setIsDrawing(true);
                const ctx = canvas.getContext('2d');
                const rect = canvas.getBoundingClientRect();
                const x = (e.touches ? e.touches[0].clientX : e.clientX) - rect.left;
                const y = (e.touches ? e.touches[0].clientY : e.clientY) - rect.top;
                ctx.beginPath();
                ctx.moveTo(x, y);
                ctx.lineWidth = 15;
                ctx.lineCap = 'round';
                ctx.lineJoin = 'round';
                ctx.strokeStyle = 'rgba(217, 70, 239, 0.7)'; // Fuchsia color
            };

            const draw = (e) => {
                if (!isDrawing) return;
                const canvas = canvasRef.current;
                const ctx = canvas.getContext('2d');
                const rect = canvas.getBoundingClientRect();
                const x = (e.touches ? e.touches[0].clientX : e.clientX) - rect.left;
                const y = (e.touches ? e.touches[0].clientY : e.clientY) - rect.top;
                ctx.lineTo(x, y);
                ctx.stroke();
            };

            // Ïì∞Í∏∞ ÏôÑÎ£å (ÎèÑÏû• ÌöçÎìù)
            const finishWriting = () => {
                if (!selectedItem) return;
                
                // ÎèÑÏû• Ï∞çÍ∏∞
                setStamps(prev => ({ ...prev, [selectedItem.char]: true }));
                
                // Ìè≠Ï£Ω Ìö®Í≥º
                confetti({
                    particleCount: 100,
                    spread: 70,
                    origin: { y: 0.6 }
                });

                // Ïπ≠Ï∞¨ ÏÜåÎ¶¨
                playSound("Ï∞∏ ÏûòÌñàÏñ¥Ïöî!");

                // Î™®Îã¨ Îã´Í∏∞ (Ïû†Ïãú ÌõÑ)
                setTimeout(() => {
                    setSelectedItem(null);
                }, 1500);
            };

            // ÌÄ¥Ï¶à ÏãúÏûë
            const startQuiz = () => {
                setQuizMode(true);
                setQuizMessage("ÏÜåÎ¶¨Î•º Îì£Í≥† Ïπ¥ÎìúÎ•º Ï∞æÏïÑÎ≥¥ÏÑ∏Ïöî!");
                nextQuiz();
            };

            const nextQuiz = () => {
                const target = currentData[Math.floor(Math.random() * currentData.length)];
                setQuizItem(target);
                setQuizMessage(`"${target.word}"ÏùÄ Ïñ¥Îîî ÏûàÏùÑÍπåÏöî?`);
                playSound(`${target.word}. ${target.word}Îäî Ïñ¥Îîî ÏûàÏùÑÍπåÏöî?`);
            };

            const checkQuiz = (item) => {
                if (item.char === quizItem.char) {
                    confetti({ particleCount: 50, spread: 50 });
                    playSound("Ï†ïÎãµÏûÖÎãàÎã§! Ï∞∏ ÏûòÌñàÏñ¥Ïöî.");
                    setQuizMessage("Ï†ïÎãµ! üéâ");
                    setTimeout(() => nextQuiz(), 1500);
                } else {
                    playSound("Îã§Ïãú ÌïúÎ≤à ÏÉùÍ∞ÅÌï¥Î≥¥ÏÑ∏Ïöî.");
                    setQuizMessage("Îï°! Îã§Ïãú Ï∞æÏïÑÎ≥¥ÏÑ∏Ïöî ü§î");
                }
            };

            const exitQuiz = () => {
                setQuizMode(false);
                setQuizItem(null);
                setQuizMessage("");
            };

            return (
                <div className="max-w-md mx-auto min-h-screen bg-white shadow-2xl flex flex-col relative">
                    {/* Header */}
                    <header className={`p-5 text-white shadow-lg z-20 rounded-b-3xl transition-colors duration-300 ${quizMode ? 'bg-indigo-600' : 'bg-gradient-to-r from-fuchsia-500 to-purple-600'}`}>
                        <div className="flex justify-between items-center">
                            <div>
                                <h1 className="text-2xl font-bold font-title flex items-center">
                                    <span className="mr-2 text-3xl">{quizMode ? 'üéÆ' : 'üê£'}</span> 
                                    {quizMode ? 'Îã®Ïñ¥ Ï∞æÍ∏∞ Í≤åÏûÑ!' : 'EAIM ÌïúÍ∏Ä ÎÜÄÏù¥ÌÑ∞'}
                                </h1>
                                <p className="text-xs text-white/80 font-medium ml-1">
                                    {quizMode ? 'Listen and find the card!' : "Korean / O'zbek / Ti·∫øng Vi·ªát"}
                                </p>
                            </div>
                            {!quizMode && (
                                <div className="flex gap-2">
                                    <span className="text-xl" title="Uzbekistan">üá∫üáø</span>
                                    <span className="text-xl" title="Vietnam">üáªüá≥</span>
                                </div>
                            )}
                            {quizMode && (
                                <button onClick={exitQuiz} className="bg-white/20 px-3 py-1 rounded-full text-xs font-bold hover:bg-white/30">ÎÇòÍ∞ÄÍ∏∞</button>
                            )}
                        </div>
                        {quizMode && (
                            <div className="mt-4 bg-white/10 p-3 rounded-xl text-center animate-bounce-slow">
                                <p className="text-lg font-bold text-yellow-300 shadow-sm">{quizMessage}</p>
                            </div>
                        )}
                    </header>

                    {/* Tabs (Hide in Quiz Mode) */}
                    {!quizMode && (
                        <div className="sticky top-0 bg-white/95 backdrop-blur-sm z-10 p-3 flex gap-2 justify-center border-b border-fuchsia-100">
                            <button onClick={() => setActiveTab('consonant')} className={`tab-btn flex-1 py-3 rounded-2xl font-bold text-lg font-title border-2 shadow-sm transition-all ${activeTab === 'consonant' ? 'active' : 'inactive'}`}>
                                ÏûêÏùå („Ñ±~„Öé)
                            </button>
                            <button onClick={() => setActiveTab('vowel')} className={`tab-btn flex-1 py-3 rounded-2xl font-bold text-lg font-title border-2 shadow-sm transition-all ${activeTab === 'vowel' ? 'active' : 'inactive'}`}>
                                Î™®Ïùå („Öè~„Ö£)
                            </button>
                        </div>
                    )}

                    {/* Grid */}
                    <div className="p-4 flex-grow overflow-y-auto hide-scrollbar pb-24">
                        <div className="grid grid-cols-2 gap-3">
                            {currentData.map((item) => (
                                <div key={item.char} onClick={() => openModal(item)} 
                                     className={`letter-card bg-white rounded-3xl p-4 flex flex-col items-center justify-center border-4 h-36 relative ${quizMode ? 'hover:bg-indigo-50 border-indigo-100' : 'border-fuchsia-50'}`}>
                                    
                                    {/* Stamp (Only in Learn Mode) */}
                                    {!quizMode && stamps[item.char] && (
                                        <div className="absolute top-2 right-2 stamp-mark pointer-events-none">
                                            <i className="fa-solid fa-stamp text-red-500 text-3xl opacity-50"></i>
                                        </div>
                                    )}

                                    <span className="text-5xl font-bold text-gray-800 font-title mb-2">{item.char}</span>
                                    <div className="flex items-center gap-2">
                                        <span className="text-xl">{item.img}</span>
                                        <span className="text-sm font-bold text-gray-500">{item.word}</span>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>

                    {/* Bottom Floating Button */}
                    {!quizMode && (
                        <div className="absolute bottom-6 right-6 z-30">
                            <button onClick={startQuiz} className="bg-gradient-to-r from-yellow-400 to-orange-500 text-white w-16 h-16 rounded-full shadow-xl flex items-center justify-center text-2xl animate-bounce hover:scale-110 transition-transform border-4 border-white">
                                üéÆ
                            </button>
                        </div>
                    )}

                    {/* Learning Modal */}
                    {selectedItem && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm p-4">
                            <div className="bg-white rounded-[2rem] w-full max-w-sm shadow-2xl overflow-hidden animate-pop relative">
                                {/* Close Button */}
                                <button onClick={() => setSelectedItem(null)} className="absolute top-4 right-4 text-gray-400 hover:text-gray-600 z-10 text-2xl">
                                    <i className="fa-solid fa-times-circle"></i>
                                </button>

                                <div className="p-6 flex flex-col items-center">
                                    <div className="flex items-center gap-4 mb-6">
                                        <span className="text-8xl font-bold text-fuchsia-600 font-title">{selectedItem.char}</span>
                                        <div className="flex flex-col gap-2">
                                            <button onClick={() => playSound(selectedItem.char)} className="w-10 h-10 bg-fuchsia-100 text-fuchsia-600 rounded-full flex items-center justify-center hover:bg-fuchsia-200">
                                                <i className="fa-solid fa-volume-high"></i>
                                            </button>
                                            <button onClick={() => playSound(selectedItem.word)} className="w-10 h-10 bg-orange-100 text-orange-600 rounded-full flex items-center justify-center hover:bg-orange-200">
                                                <i className="fa-solid fa-comment-dots"></i>
                                            </button>
                                        </div>
                                    </div>

                                    {/* Canvas */}
                                    <div className="relative w-full aspect-square bg-fuchsia-50 rounded-3xl border-4 border-fuchsia-100 mb-6 overflow-hidden">
                                        <div className="absolute inset-0 flex items-center justify-center text-[200px] font-title text-fuchsia-200/50 pointer-events-none select-none">
                                            {selectedItem.char}
                                        </div>
                                        <canvas ref={canvasRef} className="w-full h-full block touch-none"
                                            onMouseDown={startDrawing} onMouseMove={draw} onMouseUp={() => setIsDrawing(false)} onMouseLeave={() => setIsDrawing(false)}
                                            onTouchStart={startDrawing} onTouchMove={draw} onTouchEnd={() => setIsDrawing(false)}
                                        />
                                        <button onClick={initCanvas} className="absolute bottom-3 right-3 bg-white p-2 rounded-xl shadow text-gray-400 hover:text-red-500 text-sm">
                                            <i className="fa-solid fa-eraser"></i>
                                        </button>
                                    </div>

                                    {/* Word Card */}
                                    <div className="w-full bg-orange-50 rounded-2xl p-4 flex items-center gap-4 mb-4">
                                        <span className="text-4xl">{selectedItem.img}</span>
                                        <div className="flex-1">
                                            <div className="font-bold text-xl text-gray-800 mb-1">{selectedItem.word}</div>
                                            <div className="flex flex-col text-xs text-gray-500 font-medium">
                                                <span className="flex items-center gap-1">üá∫üáø {selectedItem.uzb}</span>
                                                <span className="flex items-center gap-1">üáªüá≥ {selectedItem.viet}</span>
                                            </div>
                                        </div>
                                    </div>

                                    {/* Finish Button */}
                                    <button onClick={finishWriting} className="w-full bg-fuchsia-500 hover:bg-fuchsia-600 text-white py-4 rounded-2xl font-bold text-xl shadow-lg shadow-fuchsia-200 transition transform active:scale-95 flex items-center justify-center gap-2">
                                        <span>Îã§ ÏçºÏñ¥Ïöî!</span> <i className="fa-solid fa-check"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>